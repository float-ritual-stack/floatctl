# Evna-MCP: Your Enhanced Context Concierge üß†

## Overview

Evna-MCP has been transformed from a simple context capture tool into your intelligent **context concierge** - the one who knows your patterns, your prompts, your dead bodies, and keeps you from blowing your context window.

## üéØ Core Philosophy: "Shacks Not Cathedrals"

Built specifically for **you** (Evan), not hypothetical users. Every feature serves your actual daily workflow with consciousness technology, ritual computing, and the FLOAT ecosystem.

## üß† Key Features

### 1. **Smart ChromaDB Proxy** 
- **Context Window Protection**: Warns before you hit the "context pandora's box"
- **Multi-hop Query Detection**: Recognizes when you're doing related searches
- **Intelligent Routing**: Routes queries to appropriate collections automatically
- **Usage Analytics**: Tracks patterns to optimize your workflow

### 2. **Universal :: Pattern Processor**
- **Any Pattern Recognition**: `ctx::`, `highlight::`, `decision::`, `eureka::`, `gotcha::`, `bridge::`, `concept::`, or any custom pattern
- **Smart Collection Routing**: Automatically routes patterns to the right ChromaDB collections
- **Auto-Context Surfacing**: Brings up related context based on pattern type
- **TTL Management**: Sets appropriate expiration times (highlights permanent, debug info 3 days, etc.)

### 3. **Your Personal Prompt Library**
- **consciousness_archaeology**: Deep pattern analysis and hidden dynamics
- **ritual_computing**: Design consciousness-changing protocols
- **neuroqueer_analysis**: Neurodivergent-friendly system analysis
- **shack_not_cathedral**: Strip complexity, focus on utility
- **context_crunch**: Compress context when hitting limits

### 4. **Context Intelligence**
- **"What was I working on?"**: `surface_recent_context` with smart filtering
- **Boundary Violation Detection**: Checks if you're working when you said you'd take a break
- **Usage Insights**: Shows your query patterns and optimization suggestions
- **Related Context**: Automatically surfaces relevant past work

## üõ†Ô∏è Available Tools

### Core Tools
- `smart_pattern_processor` - Universal :: pattern handler with intelligent routing
- `get_prompt` - Access your curated prompt library
- `smart_chroma_query` - Protected ChromaDB access with warnings
- `surface_recent_context` - "What was I working on?" intelligence

### Analytics & Optimization
- `get_usage_insights` - Usage patterns and optimization suggestions
- `check_boundary_status` - Boundary violation detection

### Legacy Tools (Still Available)
- `process_context_marker` - Original ctx:: processing
- `capture_pattern` - Simple pattern capture
- `search_context` - Basic context search

## üîÑ Pattern Routing Logic

| Pattern Type | Target Collection | TTL | Use Case |
|--------------|------------------|-----|----------|
| `ctx::` | active_context_stream | 36h | Context markers, mode changes |
| `highlight::` | float_highlights | Permanent | Important insights |
| `decision::` | float_dispatch_bay | Permanent | Key decisions made |
| `eureka::` | float_wins | Permanent | Breakthrough moments |
| `gotcha::` | active_context_stream | 72h | Debug discoveries |
| `bridge::` | float_bridges | Permanent | Connection points |
| `concept::` | float_dispatch_bay | 1 week | New ideas |
| `boundary::` | active_context_stream | 24h | Break declarations |

## üö® Context Window Protection

- **Pandora's Box Warning**: `‚ö†Ô∏è CONTEXT PANDORA'S BOX: ~40,000 tokens! This will blow your context window.`
- **Large Result Warning**: `‚ö†Ô∏è Large result: ~28,000 tokens. Consider filtering or summarizing.`
- **Smart Filtering**: Automatically limits results when risk is detected
- **Token Estimation**: Rough estimation (4 chars ‚âà 1 token)

## üìä Usage Analytics

Tracks:
- Query frequency and patterns
- Context window warnings
- Prompt library usage
- Multi-hop query detection
- Common search terms

Provides suggestions like:
- "Consider using more specific queries"
- "Multi-hop pattern detected - combine searches"
- "Try using get_prompt for common tasks"

## üéØ Example Usage

### Pattern Capture
```
smart_pattern_processor("eureka:: The consciousness archaeology pattern works! [concept:: pattern-dispatch] [bridge:: connects-chroma-to-ritual-computing] [project:: evna-mcp]")
```

### Prompt Retrieval
```
get_prompt("consciousness")  # Returns consciousness_archaeology prompt
get_prompt("shack")         # Returns shack_not_cathedral prompt
```

### Context Surfacing
```
surface_recent_context(hours=6)  # "What was I working on in the last 6 hours?"
```

### Smart Querying
```
smart_chroma_query("ritual computing patterns", collection="float_highlights", limit=3)
```

## üîß Technical Implementation

- **FastMCP Framework**: Modern MCP server with async support
- **Aggressive Telemetry Suppression**: No ChromaDB/PostHog noise
- **Pattern Recognition**: Regex-based with flexible metadata extraction
- **ChromaDB Integration**: Direct integration with your existing collections
- **Error Handling**: Graceful fallbacks and helpful error messages

## üéØ Next Steps

The enhanced Evna-MCP is now your **mycelial knowledge substrate** - ready to:
1. **Replace direct CHROMA_MCP usage** - Use Evna as your smart proxy
2. **Capture any :: pattern** - Universal pattern recognition and routing
3. **Protect your context window** - No more blown conversations
4. **Surface relevant context** - The concierge who knows where the bodies are buried
5. **Optimize your workflow** - Learn your patterns and suggest improvements

**Ready to deploy as your primary context concierge!** üöÄ