# Forest Plugin - CLAUDE.md

This file provides AI-specific guidance for working with the Forest plugin.

## Overview

The Forest plugin manages V0.dev projects deployed as static sites, providing deployment tracking, health checks, and toolbar injection capabilities.

## Key Concepts

### V0 Projects
- Generated by v0.dev AI
- Deployed to Vercel/Netlify
- Custom domains via float.management DNS

### Forest Structure
```
~/projects/float-workspace/artifacts/
├── float-forest-navigator/
│   ├── deployment-status.csv
│   ├── inject-toolbar.sh
│   └── data/
└── [individual project folders]
```

## Toolbar Update Feature

### Command Options
```bash
# Update all sites
floatctl forest update-toolbar --all

# Update specific number
floatctl forest update-toolbar -n 20

# Parallel processing
floatctl forest update-toolbar --all --parallel 5

# Filter by pattern
floatctl forest update-toolbar --filter "*react*"

# Preview mode
floatctl forest update-toolbar --all --dry-run

# Force re-injection
floatctl forest update-toolbar --all --force
```

### Framework Detection
The plugin detects and adapts to:
- Next.js (app/pages router)
- Create React App
- Vite
- Plain HTML
- Vue/Nuxt
- SvelteKit

### Deployment Flow
1. Downloads inject-toolbar.sh once
2. Detects framework for each site
3. Injects toolbar appropriately
4. Deploys via Vercel CLI
5. Updates deployment status

## Site Management

### Status Tracking
CSV fields tracked:
- Project name
- Status (OK, NO_DOMAIN, ERROR)
- Custom domain
- Vercel URL
- Last checked timestamp
- Issues found

### Health Checks
```python
# Status codes:
"OK" - Site responding correctly
"NO_DOMAIN" - No custom domain configured
"DNS_ERROR" - Domain not resolving
"HTTP_ERROR" - Site not responding
"CERT_ERROR" - SSL certificate issues
```

## REPL Commands

When in forest REPL mode:
```
list [filter]    # List sites with optional filter
select <n|name>  # Select site by number or name
status           # Show selected site details  
deploy [site]    # Deploy site to Vercel
check [site]     # Health check
open             # Open in browser
refresh          # Reload site data
```

## Integration Points

### With V0.dev
- Projects generated via v0.dev prompts
- Downloaded and stored locally
- Modified with FLOAT toolbars

### With Vercel
- Deployments via Vercel CLI
- Environment detection
- Build optimization

### With DNS
- Custom domains via float.management
- Automatic DNS propagation checks
- SSL certificate validation

## Common Patterns

### Batch Operations
```python
# Process sites in chunks
chunk_size = 10
for i in range(0, len(sites), chunk_size):
    chunk = sites[i:i+chunk_size]
    process_chunk(chunk)
```

### Error Recovery
- Retry failed deployments
- Log errors for investigation
- Continue on partial failures

### Progress Tracking
- Rich UI progress bars
- Spinner for long operations
- Clear success/failure reporting

## Troubleshooting

### Deployment Failures
1. Check Vercel CLI authentication
2. Verify project structure
3. Check build commands
4. Review error logs

### DNS Issues
- Allow propagation time (5-10 mins)
- Verify float.management settings
- Check domain availability

### Toolbar Injection
- Framework detection accuracy
- File path resolution
- Build process compatibility

## Future Enhancements

Consider adding:
- Automated testing post-deployment
- Performance metrics collection
- A/B testing support
- Analytics integration
- Rollback capabilities